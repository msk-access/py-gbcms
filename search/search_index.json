{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>gbcms (Get Base Counts Multi-Sample) is a high-performance tool for extracting base counts and variant metrics from BAM files.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Rust-Powered Engine: Maximum performance and memory efficiency</li> <li>Accurate Variant Handling: Full VCF/MAF support with rigorous normalization</li> <li>Comprehensive Metrics: Depth, strand counts, fragment counts, VAF, and Fisher's strand bias</li> <li>Modern CLI: User-friendly interface with rich output</li> <li>Flexible Deployment: Standalone CLI or Nextflow workflow</li> </ul>"},{"location":"#two-ways-to-use-gbcms","title":"Two Ways to Use gbcms","text":""},{"location":"#standalone-cli","title":"\ud83d\udd27 Standalone CLI","text":"<p>For processing 1-10 samples locally or on a single server.</p> <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/\n</code></pre> <p>\u2192 CLI Quick Start</p>"},{"location":"#nextflow-workflow","title":"\ud83d\udd04 Nextflow Workflow","text":"<p>For processing 10+ samples in parallel on HPC clusters.</p> <pre><code>nextflow run nextflow/main.nf --input samples.csv --variants variants.vcf --fasta ref.fa -profile slurm\n</code></pre> <p>\u2192 Nextflow Workflow Guide</p>"},{"location":"#architecture","title":"Architecture","text":"<p>gbcms uses a hybrid Python/Rust architecture: - Python: CLI, input parsing (VCF/MAF), orchestration, and output formatting - Rust: Computationally intensive read iteration, base pileup, and statistics</p>"},{"location":"#next-steps","title":"Next Steps","text":"<p>Choose your path:</p> <p>New to gbcms? 1. Installation 2. Usage Overview - Choose CLI or Nextflow 3. CLI Quick Start OR Nextflow Guide</p> <p>Already familiar? - CLI Features - Input &amp; Output Formats - Advanced Usage - Architecture Details</p>"},{"location":"CONTRIBUTING_DOCS/","title":"Documentation Development","text":""},{"location":"CONTRIBUTING_DOCS/#local-preview","title":"Local Preview","text":"<p>Preview documentation locally while editing:</p> <pre><code># Install MkDocs (first time only)\npip install mkdocs-material\n\n# Serve docs with live reload\nmkdocs serve\n</code></pre> <p>Then open http://127.0.0.1:8000 in your browser. Changes to <code>docs/</code> files will auto-refresh.</p>"},{"location":"CONTRIBUTING_DOCS/#documentation-urls","title":"Documentation URLs","text":"<ul> <li>Production (from <code>main</code>): https://msk-access.github.io/py-gbcms/</li> <li>Staging (from <code>develop</code>): https://msk-access.github.io/py-gbcms/gh-pages-staging/ (work in progress)</li> <li>GitBook: https://cmo-ci.gitbook.io/py-gbcms/</li> </ul>"},{"location":"CONTRIBUTING_DOCS/#git-flow-documentation-workflow","title":"Git-Flow Documentation Workflow","text":"<pre><code># 1. Work on feature branch\ngit checkout -b feature/update-docs\n\n# 2. Edit docs and preview locally\nmkdocs serve\n\n# 3. Push to develop\ngit push origin feature/update-docs\n# Create PR to develop\n\n# 4. Merge to develop\n# \u2192 Auto-deploys to staging URL\n\n# 5. Release: merge develop \u2192 main  \n# \u2192 Auto-deploys to production GitHub Pages\n</code></pre>"},{"location":"CONTRIBUTING_DOCS/#building-docs-manually","title":"Building Docs Manually","text":"<pre><code># Build static site\nmkdocs build\n# Output in site/ directory\n\n# Deploy to GitHub Pages\nmkdocs gh-deploy\n</code></pre>"},{"location":"NEXTFLOW/","title":"Nextflow Workflow Guide","text":"<p>This guide covers running <code>py-gbcms</code> as a Nextflow workflow for processing multiple samples in parallel, particularly on HPC clusters.</p>"},{"location":"NEXTFLOW/#overview","title":"Overview","text":"<p>The Nextflow workflow provides: - Automatic parallelization across samples - SLURM/HPC integration with resource management - Containerization with Docker/Singularity - Resume capability for failed runs - Reproducible pipelines</p>"},{"location":"NEXTFLOW/#prerequisites","title":"Prerequisites","text":"<ol> <li>Nextflow &gt;= 21.10.3</li> <li>One of:</li> <li>Docker (for local)</li> <li>Singularity (for HPC)</li> </ol> <p>Install Nextflow: <pre><code>curl -s https://get.nextflow.io | bash\nmv nextflow ~/bin/  # or any directory in your PATH\n</code></pre></p>"},{"location":"NEXTFLOW/#quick-start","title":"Quick Start","text":""},{"location":"NEXTFLOW/#1-prepare-samplesheet","title":"1. Prepare Samplesheet","text":"<p>Create a CSV file with your samples:</p> <pre><code>sample,bam,bai\nsample1,/path/to/sample1.bam,/path/to/sample1.bam.bai\nsample2,/path/to/sample2.bam,\nsample3,/path/to/sample3.bam,/path/to/sample3.bam.bai\n</code></pre> <p>Or with per-sample suffix (for multiple BAM types): <pre><code>sample,bam,bai,suffix\nsample1,/path/to/sample1.duplex.bam,,-duplex\nsample1,/path/to/sample1.simplex.bam,,-simplex\nsample1,/path/to/sample1.unfiltered.bam,,-unfiltered\nsample2,/path/to/sample2.bam,,\n</code></pre></p> <p>Notes: - <code>bai</code> column is optional - will auto-discover <code>&lt;bam&gt;.bai</code> if not provided - <code>suffix</code> column is optional - per-row suffix overrides global <code>--suffix</code> parameter - BAI files must exist or workflow will fail early with clear error</p>"},{"location":"NEXTFLOW/#2-run-the-workflow","title":"2. Run the Workflow","text":"<p>Local with Docker: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --outdir results \\\n    -profile docker\n</code></pre></p> <p>SLURM cluster with Singularity: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --outdir results \\\n    -profile slurm\n</code></pre></p>"},{"location":"NEXTFLOW/#parameters","title":"Parameters","text":""},{"location":"NEXTFLOW/#required","title":"Required","text":"Parameter Description <code>--input</code> Path to samplesheet CSV <code>--variants</code> Path to VCF/MAF variants file <code>--fasta</code> Reference FASTA (with .fai index)"},{"location":"NEXTFLOW/#output-options","title":"Output Options","text":"Parameter Default Description <code>--outdir</code> <code>results</code> Output directory <code>--format</code> <code>vcf</code> Output format (<code>vcf</code> or <code>maf</code>) <code>--suffix</code> <code>''</code> Suffix for output filenames"},{"location":"NEXTFLOW/#filtering-options","title":"Filtering Options","text":"Parameter Default Description <code>--min_mapq</code> <code>20</code> Minimum mapping quality <code>--min_baseq</code> <code>0</code> Minimum base quality <code>--filter_duplicates</code> <code>true</code> Filter duplicate reads <code>--filter_secondary</code> <code>false</code> Filter secondary alignments <code>--filter_supplementary</code> <code>false</code> Filter supplementary alignments <code>--filter_qc_failed</code> <code>false</code> Filter QC failed reads <code>--filter_improper_pair</code> <code>false</code> Filter improperly paired reads <code>--filter_indel</code> <code>false</code> Filter reads with indels"},{"location":"NEXTFLOW/#resource-limits","title":"Resource Limits","text":"Parameter Default Description <code>--max_cpus</code> <code>16</code> Maximum CPUs per job <code>--max_memory</code> <code>128.GB</code> Maximum memory per job <code>--max_time</code> <code>240.h</code> Maximum runtime per job"},{"location":"NEXTFLOW/#execution-profiles","title":"Execution Profiles","text":""},{"location":"NEXTFLOW/#docker-local","title":"Docker (Local)","text":"<p><pre><code>-profile docker\n</code></pre> - Uses Docker containers - Best for local development - Requires Docker installed</p>"},{"location":"NEXTFLOW/#singularity-hpc","title":"Singularity (HPC)","text":"<p><pre><code>-profile singularity\n</code></pre> - Uses Singularity images - Best for HPC without SLURM - Requires Singularity installed</p>"},{"location":"NEXTFLOW/#slurm-hpc-cluster","title":"SLURM (HPC Cluster)","text":"<p><pre><code>-profile slurm\n</code></pre> - Submits jobs to SLURM - Uses Singularity containers - Queue: <code>cmobic_cpu</code> (customizable)</p>"},{"location":"NEXTFLOW/#customizing-for-your-cluster","title":"Customizing for Your Cluster","text":"<p>Edit <code>nextflow/nextflow.config</code> to customize the SLURM profile:</p> <pre><code>slurm {\n    process.executor       = 'slurm'\n    process.queue          = 'your_queue_name'  // Change this\n    process.clusterOptions = '--account=your_account'  // Add if needed\n    singularity.enabled    = true\n    singularity.autoMounts = true\n}\n</code></pre> <p>Common customizations: <pre><code>process {\n    withName: GBCMS_RUN {\n        cpus   = 8          // CPUs per sample\n        memory = 16.GB      // Memory per sample\n        time   = 6.h        // Time limit per sample\n    }\n}\n</code></pre></p>"},{"location":"NEXTFLOW/#output-structure","title":"Output Structure","text":"<p>Results are organized in <code>${outdir}/</code>:</p> <pre><code>results/\n\u251c\u2500\u2500 gbcms/\n\u2502   \u251c\u2500\u2500 sample1.vcf        # Or .maf\n\u2502   \u251c\u2500\u2500 sample2.vcf\n\u2502   \u2514\u2500\u2500 sample3.vcf\n\u2514\u2500\u2500 pipeline_info/\n    \u251c\u2500\u2500 execution_report.html\n    \u251c\u2500\u2500 execution_timeline.html\n    \u2514\u2500\u2500 execution_trace.txt\n</code></pre>"},{"location":"NEXTFLOW/#advanced-usage","title":"Advanced Usage","text":""},{"location":"NEXTFLOW/#resume-failed-runs","title":"Resume Failed Runs","text":"<p>Nextflow caches completed tasks. Resume from where it failed:</p> <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    -profile slurm \\\n    -resume\n</code></pre>"},{"location":"NEXTFLOW/#custom-suffix","title":"Custom Suffix","text":"<p>Add suffix to output filenames:</p> <pre><code>--suffix .genotyped\n# Output: sample1.genotyped.vcf\n</code></pre>"},{"location":"NEXTFLOW/#maf-output","title":"MAF Output","text":"<p>Generate MAF instead of VCF:</p> <pre><code>--format maf\n# Output: sample1.maf\n</code></pre>"},{"location":"NEXTFLOW/#strict-filtering","title":"Strict Filtering","text":"<p>Enable all filters for high-quality genotyping:</p> <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --filter_duplicates true \\\n    --filter_secondary true \\\n    --filter_supplementary true \\\n    --filter_qc_failed true \\\n    -profile slurm\n</code></pre>"},{"location":"NEXTFLOW/#monitoring","title":"Monitoring","text":""},{"location":"NEXTFLOW/#view-running-jobs","title":"View Running Jobs","text":"<pre><code># SLURM\nsqueue -u $USER\n\n# Nextflow\nnextflow log\n</code></pre>"},{"location":"NEXTFLOW/#check-progress","title":"Check Progress","text":"<p>Nextflow prints real-time progress: <pre><code>[c3/a1b2c3] GBCMS_RUN (sample1) [100%] 10 of 10 \u2714\n</code></pre></p>"},{"location":"NEXTFLOW/#execution-report","title":"Execution Report","text":"<p>After completion, view the HTML report: <pre><code>open results/pipeline_info/execution_report.html\n</code></pre></p>"},{"location":"NEXTFLOW/#troubleshooting","title":"Troubleshooting","text":""},{"location":"NEXTFLOW/#job-failed-with-error","title":"Job Failed with Error","text":"<p>Check the work directory in error message: <pre><code>cat work/c3/a1b2c3/.command.log\n</code></pre></p>"},{"location":"NEXTFLOW/#out-of-memory","title":"Out of Memory","text":"<p>Increase memory in config: <pre><code>process {\n    withName: GBCMS_RUN {\n        memory = 32.GB\n    }\n}\n</code></pre></p>"},{"location":"NEXTFLOW/#wrong-queue","title":"Wrong Queue","text":"<p>Update queue name in <code>nextflow/nextflow.config</code>: <pre><code>process.queue = 'your_queue_name'\n</code></pre></p>"},{"location":"NEXTFLOW/#missing-container","title":"Missing Container","text":"<p>Pull the container manually: <pre><code># Singularity\nsingularity pull docker://ghcr.io/msk-access/py-gbcms:2.0.0\n\n# Docker\ndocker pull ghcr.io/msk-access/py-gbcms:2.0.0\n</code></pre></p>"},{"location":"NEXTFLOW/#comparison-with-cli","title":"Comparison with CLI","text":"Feature CLI Nextflow Multiple samples Sequential Parallel Resource management Manual Automatic Retry failed jobs Manual Automatic HPC integration Manual scripts Built-in Resume capability No Yes <p>When to use CLI instead: See Usage Patterns</p>"},{"location":"NEXTFLOW/#next-steps","title":"Next Steps","text":"<ul> <li>Read the CLI Reference for parameter details</li> <li>Check Input &amp; Output Formats for file specifications</li> <li>See <code>nextflow/README.md</code> for additional workflow documentation</li> </ul>"},{"location":"SUMMARY/","title":"Table of Contents","text":"<ul> <li>Introduction</li> <li>Installation</li> </ul>"},{"location":"SUMMARY/#usage-patterns","title":"Usage Patterns","text":"<ul> <li>Usage Overview</li> <li>CLI Quick Start</li> <li>Nextflow Workflow</li> </ul>"},{"location":"SUMMARY/#cli-reference","title":"CLI Reference","text":"<ul> <li>CLI Features</li> <li>Input &amp; Output Formats</li> <li>Advanced Usage</li> </ul>"},{"location":"SUMMARY/#development","title":"Development","text":"<ul> <li>Architecture</li> <li>Contributing</li> <li>Changelog</li> </ul>"},{"location":"WORKFLOWS/","title":"Usage Patterns","text":"<p><code>py-gbcms</code> can be used in two ways depending on your needs:</p>"},{"location":"WORKFLOWS/#standalone-cli-singlefew-samples","title":"\ud83d\udd27 Standalone CLI (Single/Few Samples)","text":"<p>Best for: - Processing 1-10 samples - Quick ad-hoc analysis - Local development and testing - Direct control over parameters</p> <p>Pros: - \u2705 Simple - just one command - \u2705 Fast to set up - \u2705 Full control over threading - \u2705 Works anywhere (local, server, container)</p> <p>Cons: - \u274c Manual parallelization for multiple samples - \u274c No automatic resource management - \u274c Requires manual error handling</p> <p>Example: <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample1.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre></p> <p>Learn more: CLI Quick Start</p>"},{"location":"WORKFLOWS/#nextflow-workflow-many-samples-hpc","title":"\ud83d\udd04 Nextflow Workflow (Many Samples, HPC)","text":"<p>Best for: - Processing 10+ samples - HPC/SLURM cluster environments - Reproducible pipelines - Automated retry and error handling</p> <p>Pros: - \u2705 Automatic parallelization across samples - \u2705 Smart resource management - \u2705 Built-in retry logic - \u2705 Resume failed runs - \u2705 Portable (Docker/Singularity)</p> <p>Cons: - \u274c Requires Nextflow installation - \u274c More setup (samplesheet, config) - \u274c Learning curve for Nextflow DSL</p> <p>Example: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    -profile slurm\n</code></pre></p> <p>Learn more: Nextflow Workflow Guide</p>"},{"location":"WORKFLOWS/#quick-comparison","title":"\ud83d\udcca Quick Comparison","text":"Feature CLI Nextflow Setup complexity Low Medium Best for # samples 1-10 10+ Parallelization Manual Automatic Resource management Manual Automatic HPC integration Manual Built-in Resume failed jobs No Yes Reproducibility Good Excellent"},{"location":"WORKFLOWS/#which-should-i-use","title":"Which Should I Use?","text":""},{"location":"WORKFLOWS/#use-cli-if-you","title":"Use CLI if you:","text":"<ul> <li>Have a few samples to process</li> <li>Want quick results</li> <li>Are working locally or on a single server</li> <li>Need full manual control</li> </ul>"},{"location":"WORKFLOWS/#use-nextflow-if-you","title":"Use Nextflow if you:","text":"<ul> <li>Have many samples (10+)</li> <li>Are on an HPC cluster (SLURM, PBS, etc.)</li> <li>Need reproducible pipelines</li> <li>Want automatic parallelization and error handling</li> <li>Plan to re-run the analysis multiple times</li> </ul>"},{"location":"quick-start/","title":"Quick Start Guide","text":"<p>This guide shows you how to get started with <code>py-gbcms</code> using the standalone CLI for processing one or a few samples.</p> <p>Processing many samples? Use the Nextflow Workflow instead for automatic parallelization on HPC clusters.</p>"},{"location":"quick-start/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python &gt;= 3.10</li> <li>Rust toolchain (for installation from source)</li> <li>BAM files with index (.bai)</li> <li>Reference FASTA with index (.fai)</li> <li>Variants file (VCF or MAF)</li> </ul> <p>See Installation Guide for detailed setup instructions.</p>"},{"location":"quick-start/#basic-usage","title":"Basic Usage","text":""},{"location":"quick-start/#single-sample","title":"Single Sample","text":"<p>Count variants for one sample:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample1.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Output: <code>results/sample1.vcf</code></p>"},{"location":"quick-start/#multiple-samples","title":"Multiple Samples","text":"<p>Process multiple samples sequentially:</p> <pre><code># Sample 1\ngbcms run --variants variants.vcf --bam sample1.bam --fasta ref.fa --output-dir results/\n\n# Sample 2\ngbcms run --variants variants.vcf --bam sample2.bam --fasta ref.fa --output-dir results/\n\n# Sample 3\ngbcms run --variants variants.vcf --bam sample3.bam --fasta ref.fa --output-dir results/\n</code></pre> <p>Or use a BAM list file:</p> <pre><code># Create bam_list.txt with:\n# sample1 /path/to/sample1.bam\n# sample2 /path/to/sample2.bam\n\ngbcms run \\\n    --variants variants.vcf \\\n    --bam-list bam_list.txt \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Note: The CLI processes samples sequentially. For parallel processing of many samples, use the Nextflow Workflow.</p>"},{"location":"quick-start/#common-options","title":"Common Options","text":""},{"location":"quick-start/#output-format","title":"Output Format","text":"<p>VCF (default): <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --format vcf\n</code></pre></p> <p>MAF: <pre><code>gbcms run --variants variants.maf --bam sample.bam --fasta ref.fa --output-dir results/ --format maf\n</code></pre></p>"},{"location":"quick-start/#custom-sample-ids","title":"Custom Sample IDs","text":"<p>Override the sample name:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam MySampleID:sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Output: <code>results/MySampleID.vcf</code></p>"},{"location":"quick-start/#output-suffix","title":"Output Suffix","text":"<p>Add suffix to output filenames:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/ \\\n    --suffix .genotyped\n</code></pre> <p>Output: <code>results/sample.genotyped.vcf</code></p>"},{"location":"quick-start/#threading","title":"Threading","text":"<p>Use multiple threads for processing:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/ \\\n    --threads 4\n</code></pre>"},{"location":"quick-start/#quality-filters","title":"Quality Filters","text":"<p>Minimum mapping quality: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --min-mapq 30\n</code></pre></p> <p>Minimum base quality: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --min-baseq 20\n</code></pre></p> <p>Filter duplicates (default: enabled): <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --filter-duplicates\n</code></pre></p> <p>Filter secondary alignments: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --filter-secondary\n</code></pre></p>"},{"location":"quick-start/#complete-example","title":"Complete Example","text":"<p>Process a sample with strict filtering:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam TumorSample:tumor.bam \\\n    --fasta hg19.fa \\\n    --output-dir genotyped_results/ \\\n    --format vcf \\\n    --suffix .genotyped \\\n    --threads 8 \\\n    --min-mapq 30 \\\n    --min-baseq 20 \\\n    --filter-duplicates \\\n    --filter-secondary \\\n    --filter-supplementary\n</code></pre> <p>Output: <code>genotyped_results/TumorSample.genotyped.vcf</code></p>"},{"location":"quick-start/#using-docker","title":"Using Docker","text":"<p>Run via Docker container:</p> <pre><code>docker run --rm -v $(pwd):/data ghcr.io/msk-access/py-gbcms:2.0.0 \\\n    gbcms run \\\n    --variants /data/variants.vcf \\\n    --bam /data/sample.bam \\\n    --fasta /data/reference.fa \\\n    --output-dir /data/results/\n</code></pre>"},{"location":"quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Advanced filtering: See Advanced Usage</li> <li>All CLI options: See CLI Reference</li> <li>File formats: See Input &amp; Output Formats</li> <li>Many samples on HPC: See Nextflow Workflow</li> </ul>"}]}