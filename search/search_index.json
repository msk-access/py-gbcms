{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>gbcms (Get Base Counts Multi-Sample) is a high-performance tool for extracting base counts and variant metrics from BAM files.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Rust-Powered Engine: Maximum performance and memory efficiency</li> <li>Accurate Variant Handling: Full VCF/MAF support with rigorous normalization</li> <li>Comprehensive Metrics: Depth, strand counts, fragment counts, VAF, and Fisher's strand bias</li> <li>Modern CLI: User-friendly interface with rich output</li> <li>Flexible Deployment: Standalone CLI or Nextflow workflow</li> </ul>"},{"location":"#two-ways-to-use-gbcms","title":"Two Ways to Use gbcms","text":""},{"location":"#standalone-cli","title":"\ud83d\udd27 Standalone CLI","text":"<p>For processing 1-10 samples locally or on a single server.</p> <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/\n</code></pre> <p>\u2192 CLI Quick Start</p>"},{"location":"#nextflow-workflow","title":"\ud83d\udd04 Nextflow Workflow","text":"<p>For processing 10+ samples in parallel on HPC clusters.</p> <pre><code>nextflow run nextflow/main.nf --input samples.csv --variants variants.vcf --fasta ref.fa -profile slurm\n</code></pre> <p>\u2192 Nextflow Workflow Guide</p>"},{"location":"#architecture","title":"Architecture","text":"<p>gbcms uses a hybrid Python/Rust architecture: - Python: CLI, input parsing (VCF/MAF), orchestration, and output formatting - Rust: Computationally intensive read iteration, base pileup, and statistics</p>"},{"location":"#next-steps","title":"Next Steps","text":"<p>Choose your path:</p> <p>New to gbcms? 1. Usage Overview - Choose CLI or Nextflow 2. CLI Quick Start OR Nextflow Guide</p> <p>Contributing: - Contributing Guide</p>"},{"location":"CHANGELOG/","title":"Changelog","text":"<p>All notable changes to this project will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"CHANGELOG/#210-2025-11-25","title":"[2.1.0] - 2025-11-25","text":""},{"location":"CHANGELOG/#added","title":"\u2728 Added","text":""},{"location":"CHANGELOG/#nextflow-workflow","title":"Nextflow Workflow","text":"<ul> <li>Production-ready Nextflow workflow for processing multiple samples in parallel</li> <li>SLURM cluster support with customizable queue configuration</li> <li>Per-sample suffix support via optional <code>suffix</code> column in samplesheet</li> <li>Docker and Singularity profiles for containerized execution</li> <li>Automatic BAI index discovery with validation</li> <li>Resume capability for failed workflow runs</li> <li>Resource management with automatic retry and scaling</li> <li>Comprehensive documentation in <code>docs/NEXTFLOW.md</code> and <code>nextflow/README.md</code></li> </ul>"},{"location":"CHANGELOG/#documentation","title":"Documentation","text":"<ul> <li>Usage pattern comparison guide (<code>docs/WORKFLOWS.md</code>) for choosing between CLI and Nextflow</li> <li>MkDocs integration for beautiful GitHub Pages documentation</li> <li>Local documentation preview with live reload (<code>mkdocs serve</code>)</li> <li>Staging deployment from <code>develop</code> branch for testing docs</li> <li>Production deployment from <code>main</code> branch</li> <li>Reorganized documentation structure with clear CLI vs Nextflow separation</li> <li>CLI Quick Start guide (<code>docs/quick-start.md</code>)</li> </ul>"},{"location":"CHANGELOG/#changed","title":"\ud83d\udd27 Changed","text":"<ul> <li>Documentation workflow: docs now live on <code>main</code> branch with automated deployment</li> <li>GitBook integration: configured to read from <code>main</code> branch</li> <li>Nextflow module: improved parameter passing with meta.suffix support</li> </ul>"},{"location":"CHANGELOG/#documentation_1","title":"\ud83d\udcdd Documentation","text":"<ul> <li>Complete Nextflow workflow guide with SLURM examples</li> <li>Per-sample suffix usage examples</li> <li>Git-flow documentation workflow guide</li> <li>Local preview instructions</li> <li>Updated README with clear usage pattern separation</li> </ul>"},{"location":"CHANGELOG/#200-2025-11-21","title":"[2.0.0] - 2025-11-21","text":""},{"location":"CHANGELOG/#major-rewrite","title":"\ud83d\ude80 Major Rewrite","text":"<p>Version 2.0.0 represents a complete rewrite of py-gbcms with a focus on performance, correctness, and modern architecture.</p>"},{"location":"CHANGELOG/#added_1","title":"\u2728 Added","text":""},{"location":"CHANGELOG/#core-features","title":"Core Features","text":"<ul> <li>Rust-based Counting Engine: Hybrid Python/Rust architecture for 20x+ performance improvement</li> <li>Strand Bias Statistics: Fisher's exact test p-values and odds ratios for both reads (<code>SB_PVAL</code>, <code>SB_OR</code>) and fragments (<code>FSB_PVAL</code>, <code>FSB_OR</code>)</li> <li>Fragment-Level Counting: Majority-rule fragment counting with strand-specific counts (<code>RDF</code>, <code>ADF</code>)</li> <li>Variant Allele Fractions: Read-level (<code>VAF</code>) and fragment-level (<code>FAF</code>) allele fraction calculations</li> <li>Thread Control: Explicit control over parallelism via <code>--threads</code> argument (default: 1)</li> </ul>"},{"location":"CHANGELOG/#inputoutput","title":"Input/Output","text":"<ul> <li>VCF Output Format: Standard VCF with comprehensive INFO and FORMAT fields</li> <li>MAF Output Format: Extended MAF with custom columns for strand counts and statistics</li> <li>Column Preservation: Input MAF columns are preserved in output</li> <li>Multiple BAM Support: Process multiple samples via <code>--bam-list</code> or repeated <code>--bam</code> arguments</li> <li>Sample ID Override: Explicit sample naming via <code>--bam sample_id:path</code> syntax</li> </ul>"},{"location":"CHANGELOG/#filters","title":"Filters","text":"<ul> <li><code>--filter-duplicates</code>: Filter duplicate reads (default: enabled)</li> <li><code>--filter-secondary</code>: Filter secondary alignments</li> <li><code>--filter-supplementary</code>: Filter supplementary alignments</li> <li><code>--filter-qc-failed</code>: Filter reads that failed QC</li> <li><code>--filter-improper-pair</code>: Filter improperly paired reads</li> <li><code>--filter-indel</code>: Filter reads with indels in CIGAR</li> </ul>"},{"location":"CHANGELOG/#cli-usability","title":"CLI &amp; Usability","text":"<ul> <li>Modern CLI: Built with Typer and Rich for beautiful terminal output</li> <li>Progress Tracking: Real-time progress bars and status indicators</li> <li>Direct Invocation: Use <code>gbcms run</code> instead of <code>python -m gbcms.cli</code></li> <li>Output Customization: <code>--suffix</code> flag for output filename customization</li> <li>Flexible Input: Support for both VCF and MAF input formats</li> </ul>"},{"location":"CHANGELOG/#infrastructure","title":"Infrastructure","text":"<ul> <li>Docker Support: Production-ready multi-stage Dockerfile with optimized layers</li> <li>Type Safety: Full type annotations with mypy support</li> <li>Type Stubs: Provided <code>.pyi</code> stub file for Rust extension</li> <li>Comprehensive Tests: Extended test suite with accuracy and filter validation</li> <li>CI/CD: GitHub Actions workflows for testing, linting, and releases</li> </ul>"},{"location":"CHANGELOG/#changed_1","title":"\ud83d\udd04 Changed","text":""},{"location":"CHANGELOG/#architecture","title":"Architecture","text":"<ul> <li>Migrated from pure Python to hybrid Python/Rust architecture</li> <li>Core counting logic implemented in Rust using <code>rust-htslib</code></li> <li>Data parallelism over variants with per-thread BAM readers</li> </ul>"},{"location":"CHANGELOG/#output-formats","title":"Output Formats","text":"<ul> <li>VCF FORMAT fields: Strand-specific counts now use comma-separated values (e.g., <code>RD=5,3</code> for forward,reverse)</li> <li>MAF columns: Standardized column names (<code>t_ref_count_forward</code>, <code>t_alt_count_reverse</code>, etc.)</li> <li>Coordinate System: Internal 0-based indexing with correct conversion for VCF (1-based) and MAF output</li> </ul>"},{"location":"CHANGELOG/#performance","title":"Performance","text":"<ul> <li>Speed: 20x+ faster than v1.x on typical datasets</li> <li>Memory: Efficient per-thread BAM readers with minimal overhead</li> <li>Scalability: Configurable thread pool for optimal resource usage</li> </ul>"},{"location":"CHANGELOG/#dependencies","title":"Dependencies","text":"<ul> <li>Python: Updated to require Python \u22653.10</li> <li>Rust: pyo3 0.27.1, rust-htslib 0.51.0, statrs 0.18.0</li> <li>Python Packages: pysam \u22650.21.0, typer \u22650.9.0, rich \u226513.0.0, pydantic \u22652.0.0</li> </ul>"},{"location":"CHANGELOG/#removed","title":"\ud83d\uddd1\ufe0f Removed","text":"<ul> <li>Legacy Python Counting: Pure Python implementation removed in favor of Rust</li> <li>Old CLI: Deprecated <code>python -m gbcms.cli</code> entry point</li> <li>Unused Dependencies: Removed <code>cyvcf2</code> and <code>numba</code> (no longer needed)</li> <li>Pre-commit Hooks: Removed in favor of explicit linting in CI</li> </ul>"},{"location":"CHANGELOG/#fixed","title":"\ud83d\udc1b Fixed","text":"<ul> <li>Correct handling of complex variants (MNPs, DelIns)</li> <li>Proper strand assignment for fragment counting</li> <li>Reference validation against FASTA for all variant types</li> <li>Thread-safe BAM access with per-thread readers</li> </ul>"},{"location":"CHANGELOG/#documentation_2","title":"\ud83d\udcda Documentation","text":"<ul> <li>Complete rewrite of all documentation</li> <li>New guides: <code>INSTALLATION.md</code>, <code>CLI_FEATURES.md</code>, <code>INPUT_OUTPUT.md</code></li> <li>Comprehensive API documentation</li> <li>Docker usage examples</li> <li>Contributing guidelines updated</li> </ul>"},{"location":"CHANGELOG/#technical-details","title":"\ud83d\udd27 Technical Details","text":""},{"location":"CHANGELOG/#rust-components","title":"Rust Components","text":"<ul> <li><code>gbcms_rs</code>: PyO3-based extension module</li> <li>Fisher's exact test via <code>statrs</code> crate</li> <li>Rayon-based parallelism with configurable thread pools</li> <li>Safe memory management with Rust's ownership model</li> </ul>"},{"location":"CHANGELOG/#testing","title":"Testing","text":"<ul> <li>16 comprehensive test cases</li> <li>Accuracy validation with synthetic BAM files</li> <li>Filter validation for all read flag combinations</li> <li>Integration tests with real-world data</li> </ul>"},{"location":"CHANGELOG/#breaking-changes","title":"\u26a0\ufe0f Breaking Changes","text":"<p>Version 2.0.0 is not backward compatible with 1.x. Key breaking changes:</p> <ol> <li>CLI syntax: Use <code>gbcms run</code> instead of <code>python -m gbcms.cli</code></li> <li>Output format: VCF/MAF column structures have changed</li> <li>Default behavior: Only duplicate filtering enabled by default (was: all filters)</li> <li>Dependencies: Requires Rust toolchain for installation from source</li> <li>Python version: Minimum Python 3.10 (was: 3.8)</li> </ol>"},{"location":"CHANGELOG/#installation","title":"\ud83d\udce6 Installation","text":"<pre><code># From PyPI (includes pre-built wheels)\npip install py-gbcms\n\n# From source (requires Rust)\npip install git+https://github.com/msk-access/py-gbcms.git\n\n# Docker\ndocker pull ghcr.io/msk-access/py-gbcms:2.0.0\n</code></pre>"},{"location":"CHANGELOG/#acknowledgments","title":"\ud83d\ude4f Acknowledgments","text":"<p>This rewrite was designed and implemented with a focus on correctness, performance, and modern best practices in bioinformatics software development.</p>"},{"location":"CHANGELOG/#1x-legacy","title":"[1.x] - Legacy","text":"<p>Previous versions (1.x) used a pure Python implementation. See git history for details.</p>"},{"location":"CONTRIBUTING/","title":"Contributing to py-gbcms","text":"<p>Thank you for your interest in contributing to py-gbcms! This guide covers both code contributions and documentation updates.</p>"},{"location":"CONTRIBUTING/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Code Contributions</li> <li>Documentation Contributions</li> <li>Reporting Issues</li> </ul>"},{"location":"CONTRIBUTING/#code-contributions","title":"Code Contributions","text":""},{"location":"CONTRIBUTING/#development-setup","title":"Development Setup","text":"<ol> <li> <p>Clone the repository <pre><code>git clone https://github.com/msk-access/py-gbcms.git\ncd py-gbcms\n</code></pre></p> </li> <li> <p>Install uv (if not already installed)    <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre></p> </li> <li> <p>Install development dependencies <pre><code>uv pip install -e \".[dev]\"\n</code></pre></p> </li> </ol>"},{"location":"CONTRIBUTING/#development-workflow","title":"Development Workflow","text":""},{"location":"CONTRIBUTING/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\npytest\n\n# Run with coverage\npytest --cov=gbcms --cov-report=html\n\n# Run specific test file\npytest tests/test_counter.py\n\n# Run with verbose output\npytest -v\n</code></pre>"},{"location":"CONTRIBUTING/#code-quality","title":"Code Quality","text":"<pre><code># Format code\nblack src/ tests/\n\n# Lint code\nruff check src/ tests/\n\n# Fix linting issues automatically\nruff check --fix src/ tests/\n\n# Type checking\nmypy src/\n</code></pre>"},{"location":"CONTRIBUTING/#building-and-testing-docker","title":"Building and Testing Docker","text":"<pre><code># Build Docker image\ndocker build -t gbcms:latest .\n</code></pre>"},{"location":"CONTRIBUTING/#code-style","title":"Code Style","text":"<ul> <li>Follow PEP 8 style guidelines</li> <li>Use type hints for all function signatures</li> <li>Write docstrings for all public functions and classes</li> <li>Keep functions focused and single-purpose</li> <li>Maximum line length: 100 characters</li> </ul>"},{"location":"CONTRIBUTING/#testing-guidelines","title":"Testing Guidelines","text":"<ul> <li>Write tests for all new features</li> <li>Maintain or improve code coverage</li> <li>Use descriptive test names</li> <li>Use fixtures for common test setup</li> <li>Test edge cases and error conditions</li> </ul>"},{"location":"CONTRIBUTING/#pull-request-process","title":"Pull Request Process","text":"<ol> <li> <p>Create a feature branch <pre><code>git checkout -b feature/your-feature-name\n</code></pre></p> </li> <li> <p>Make your changes</p> </li> <li>Write code following the style guidelines</li> <li>Add tests for new functionality</li> <li> <p>Update documentation as needed</p> </li> <li> <p>Run tests and linters <pre><code>make test\nmake lint\n</code></pre></p> </li> <li> <p>Commit your changes <pre><code>git add .\ngit commit -m \"Description of your changes\"\n</code></pre></p> </li> <li> <p>Push to your fork <pre><code>git push origin feature/your-feature-name\n</code></pre></p> </li> <li> <p>Create a Pull Request</p> </li> <li>Provide a clear description of the changes</li> <li>Reference any related issues</li> <li>Ensure all CI checks pass</li> </ol>"},{"location":"CONTRIBUTING/#documentation-contributions","title":"Documentation Contributions","text":""},{"location":"CONTRIBUTING/#local-preview","title":"Local Preview","text":"<p>Preview documentation locally while editing:</p> <pre><code># Install MkDocs (first time only)\npip install mkdocs-material\n\n# Serve docs with live reload\nmkdocs serve\n</code></pre> <p>Then open http://127.0.0.1:8000 in your browser. Changes to <code>docs/</code> files will auto-refresh.</p>"},{"location":"CONTRIBUTING/#documentation-urls","title":"Documentation URLs","text":"<ul> <li>Production (from <code>main</code>): https://msk-access.github.io/py-gbcms/</li> <li>Staging (from <code>develop</code>): https://msk-access.github.io/py-gbcms/gh-pages-staging/</li> <li>GitBook: https://cmo-ci.gitbook.io/py-gbcms/</li> </ul>"},{"location":"CONTRIBUTING/#git-flow-documentation-workflow","title":"Git-Flow Documentation Workflow","text":"<pre><code># 1. Work on feature branch\ngit checkout -b feature/update-docs\n\n# 2. Edit docs and preview locally\nmkdocs serve\n\n# 3. Push to develop\ngit push origin feature/update-docs\n# Create PR to develop\n\n# 4. Merge to develop\n# \u2192 Auto-deploys to staging URL\n\n# 5. Release: merge develop \u2192 main  \n# \u2192 Auto-deploys to production GitHub Pages\n</code></pre>"},{"location":"CONTRIBUTING/#building-docs-manually","title":"Building Docs Manually","text":"<pre><code># Build static site\nmkdocs build\n# Output in site/ directory\n\n# Deploy to GitHub Pages (maintainers only)\nmkdocs gh-deploy\n</code></pre>"},{"location":"CONTRIBUTING/#reporting-issues","title":"Reporting Issues","text":"<p>When reporting issues, please include:</p> <ul> <li>Python version</li> <li>Operating system</li> <li>Steps to reproduce</li> <li>Expected behavior</li> <li>Actual behavior</li> <li>Error messages or logs</li> </ul>"},{"location":"CONTRIBUTING/#feature-requests","title":"Feature Requests","text":"<p>We welcome feature requests! Please:</p> <ul> <li>Check if the feature already exists</li> <li>Provide a clear use case</li> <li>Describe the expected behavior</li> <li>Consider submitting a PR if you can implement it</li> </ul>"},{"location":"CONTRIBUTING/#code-of-conduct","title":"Code of Conduct","text":"<ul> <li>Be respectful and inclusive</li> <li>Welcome newcomers</li> <li>Focus on constructive feedback</li> <li>Help others learn and grow</li> </ul>"},{"location":"CONTRIBUTING/#questions","title":"Questions?","text":"<p>Feel free to open an issue for questions or reach out to the maintainers.</p> <p>Thank you for contributing!</p>"},{"location":"INSTALLATION/","title":"Installation Guide","text":"<p>This guide covers all methods for installing py-gbcms.</p>"},{"location":"INSTALLATION/#quick-install-recommended","title":"Quick Install (Recommended)","text":""},{"location":"INSTALLATION/#pypi-installation","title":"PyPI Installation","text":"<p>Install the latest stable release:</p> <pre><code>pip install py-gbcms\n</code></pre> <p>Verify installation:</p> <pre><code>gbcms --version\n</code></pre>"},{"location":"INSTALLATION/#docker","title":"Docker","text":"<p>Pull the official Docker image:</p> <pre><code>docker pull ghcr.io/msk-access/py-gbcms:2.1.0\n</code></pre> <p>Run via Docker:</p> <pre><code>docker run --rm ghcr.io/msk-access/py-gbcms:2.1.0 gbcms --help\n</code></pre>"},{"location":"INSTALLATION/#requirements","title":"Requirements","text":""},{"location":"INSTALLATION/#system-requirements","title":"System Requirements","text":"<ul> <li>Python: 3.10 or higher</li> <li>Operating Systems: Linux, macOS, Windows (with WSL2)</li> <li>Memory: Minimum 4GB RAM (8GB+ recommended for large BAM files)</li> <li>Disk: Varies by BAM file size</li> </ul>"},{"location":"INSTALLATION/#for-source-installation","title":"For Source Installation","text":"<ul> <li>Rust toolchain: 1.70 or higher (for building from source)</li> <li>Build tools: <code>gcc</code>, <code>make</code> (Linux/macOS)</li> </ul>"},{"location":"INSTALLATION/#for-nextflow-workflow","title":"For Nextflow Workflow","text":"<ul> <li>Nextflow: 21.10.3 or higher</li> <li>Container runtime: Docker or Singularity</li> <li>HPC scheduler: SLURM (optional, for cluster execution)</li> </ul>"},{"location":"INSTALLATION/#installation-methods","title":"Installation Methods","text":""},{"location":"INSTALLATION/#1-pypi-stable-release","title":"1. PyPI (Stable Release)","text":"<p>Best for: Most users, production use</p> <pre><code>pip install py-gbcms\n</code></pre> <p>Benefits: - Pre-compiled wheels for major platforms - No Rust toolchain required - Fastest installation</p>"},{"location":"INSTALLATION/#2-from-source-development","title":"2. From Source (Development)","text":"<p>Best for: Developers, contributing code, bleeding-edge features</p>"},{"location":"INSTALLATION/#prerequisites","title":"Prerequisites","text":"<p>Install Rust toolchain:</p> <pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\nsource $HOME/.cargo/env\n</code></pre>"},{"location":"INSTALLATION/#installation-steps","title":"Installation Steps","text":"<pre><code># Clone repository\ngit clone https://github.com/msk-access/py-gbcms.git\ncd py-gbcms\n\n# Install with uv (recommended)\ncurl -LsSf https://astral.sh/uv/install.sh | sh\nuv pip install -e \".[dev]\"\n\n# OR install with pip\npip install -e \".[dev]\"\n</code></pre> <p>Verify:</p> <pre><code>gbcms --version\n</code></pre>"},{"location":"INSTALLATION/#3-docker","title":"3. Docker","text":"<p>Best for: Reproducibility, containerized workflows, no local dependencies</p>"},{"location":"INSTALLATION/#pull-image","title":"Pull Image","text":"<pre><code># Latest stable release\ndocker pull ghcr.io/msk-access/py-gbcms:2.1.0\n\n# Or use 'latest' tag\ndocker pull ghcr.io/msk-access/py-gbcms:latest\n</code></pre>"},{"location":"INSTALLATION/#usage-example","title":"Usage Example","text":"<pre><code>docker run --rm \\\n  -v $(pwd):/data \\\n  ghcr.io/msk-access/py-gbcms:2.1.0 \\\n  gbcms run \\\n    --variants /data/variants.vcf \\\n    --bam /data/sample.bam \\\n    --fasta /data/reference.fa \\\n    --output-dir /data/results/\n</code></pre> <p>Note: Use <code>-v</code> to mount your data directory into the container.</p>"},{"location":"INSTALLATION/#4-singularity-hpc","title":"4. Singularity (HPC)","text":"<p>Best for: HPC clusters without Docker</p> <pre><code># Pull from Docker registry\nsingularity pull docker://ghcr.io/msk-access/py-gbcms:2.1.0\n\n# Run\nsingularity exec py-gbcms_2.1.0.sif gbcms --help\n</code></pre>"},{"location":"INSTALLATION/#nextflow-workflow-setup","title":"Nextflow Workflow Setup","text":"<p>For processing multiple samples in parallel:</p>"},{"location":"INSTALLATION/#1-install-nextflow","title":"1. Install Nextflow","text":"<pre><code>curl -s https://get.nextflow.io | bash\nmv nextflow ~/bin/  # or any directory in your PATH\n</code></pre> <p>Verify:</p> <pre><code>nextflow -version\n</code></pre>"},{"location":"INSTALLATION/#2-install-container-runtime","title":"2. Install Container Runtime","text":"<p>Docker (local):</p> <p>Follow instructions at https://docs.docker.com/engine/installation/</p> <p>Singularity (HPC):</p> <p>Singularity is usually pre-installed on HPC systems. Check with:</p> <pre><code>singularity --version\n</code></pre> <p>If not available, contact your system administrator.</p>"},{"location":"INSTALLATION/#3-clone-repository-for-nextflow-workflow","title":"3. Clone Repository (for Nextflow workflow)","text":"<pre><code>git clone https://github.com/msk-access/py-gbcms.git\ncd py-gbcms\n</code></pre> <p>The Nextflow workflow is in the <code>nextflow/</code> directory.</p>"},{"location":"INSTALLATION/#verification","title":"Verification","text":""},{"location":"INSTALLATION/#test-installation","title":"Test Installation","text":"<p>Run a simple command:</p> <pre><code>gbcms --help\n</code></pre> <p>Expected output:</p> <pre><code>Usage: gbcms [OPTIONS] COMMAND [ARGS]...\n\n  py-gbcms: Get Base Counts Multi-Sample\n\nOptions:\n  --version  Show version and exit\n  --help     Show this message and exit\n\nCommands:\n  run  Run variant counting\n</code></pre>"},{"location":"INSTALLATION/#check-version","title":"Check Version","text":"<pre><code>gbcms --version\n</code></pre> <p>Should show: <code>2.1.0</code> (or current version)</p>"},{"location":"INSTALLATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"INSTALLATION/#python-version-issues","title":"Python Version Issues","text":"<p>Error: <code>Python 3.10+ required</code></p> <p>Solution:</p> <pre><code># Check Python version\npython --version\n\n# Install Python 3.10+ (Ubuntu/Debian)\nsudo apt update\nsudo apt install python3.10 python3.10-pip\n\n# Use pyenv (any OS)\npyenv install 3.10.0\npyenv global 3.10.0\n</code></pre>"},{"location":"INSTALLATION/#rust-toolchain-not-found","title":"Rust Toolchain Not Found","text":"<p>Error: <code>cargo not found</code> or <code>rustc not found</code></p> <p>Solution:</p> <pre><code># Install Rust\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n\n# Reload shell\nsource $HOME/.cargo/env\n\n# Verify\nrustc --version\n</code></pre>"},{"location":"INSTALLATION/#docker-permission-denied","title":"Docker Permission Denied","text":"<p>Error: <code>permission denied while trying to connect to the Docker daemon</code></p> <p>Solution:</p> <pre><code># Add user to docker group (Linux)\nsudo usermod -aG docker $USER\nnewgrp docker\n\n# Or use sudo\nsudo docker pull ghcr.io/msk-access/py-gbcms:2.1.0\n</code></pre>"},{"location":"INSTALLATION/#module-import-errors","title":"Module Import Errors","text":"<p>Error: <code>ModuleNotFoundError: No module named 'gbcms'</code></p> <p>Solution:</p> <pre><code># Reinstall\npip uninstall py-gbcms\npip install py-gbcms\n\n# Or force reinstall\npip install --force-reinstall py-gbcms\n</code></pre>"},{"location":"INSTALLATION/#bam-index-not-found","title":"BAM Index Not Found","text":"<p>Error: <code>BAI index not found</code></p> <p>Solution:</p> <pre><code># Create BAM index\nsamtools index sample.bam\n</code></pre> <p>This creates <code>sample.bam.bai</code> in the same directory.</p>"},{"location":"INSTALLATION/#upgrading","title":"Upgrading","text":""},{"location":"INSTALLATION/#upgrade-from-pypi","title":"Upgrade from PyPI","text":"<pre><code>pip install --upgrade py-gbcms\n</code></pre>"},{"location":"INSTALLATION/#upgrade-docker-image","title":"Upgrade Docker Image","text":"<pre><code>docker pull ghcr.io/msk-access/py-gbcms:latest\n</code></pre>"},{"location":"INSTALLATION/#upgrade-from-source","title":"Upgrade from Source","text":"<pre><code>cd py-gbcms\ngit pull origin main\npip install -e \".[dev]\"\n</code></pre>"},{"location":"INSTALLATION/#uninstallation","title":"Uninstallation","text":""},{"location":"INSTALLATION/#pypi","title":"PyPI","text":"<pre><code>pip uninstall py-gbcms\n</code></pre>"},{"location":"INSTALLATION/#docker_1","title":"Docker","text":"<pre><code>docker rmi ghcr.io/msk-access/py-gbcms:2.1.0\n</code></pre>"},{"location":"INSTALLATION/#singularity","title":"Singularity","text":"<pre><code>rm py-gbcms_2.1.0.sif\n</code></pre>"},{"location":"INSTALLATION/#next-steps","title":"Next Steps","text":"<p>After installation:</p> <ul> <li>CLI Users: See CLI Quick Start</li> <li>Nextflow Users: See Nextflow Workflow Guide</li> <li>Choosing a method: See Usage Patterns</li> </ul>"},{"location":"NEXTFLOW/","title":"Nextflow Workflow Guide","text":"<p>This guide covers running <code>py-gbcms</code> as a Nextflow workflow for processing multiple samples in parallel, particularly on HPC clusters.</p>"},{"location":"NEXTFLOW/#overview","title":"Overview","text":"<p>The Nextflow workflow provides: - Automatic parallelization across samples - SLURM/HPC integration with resource management - Containerization with Docker/Singularity - Resume capability for failed runs - Reproducible pipelines</p>"},{"location":"NEXTFLOW/#prerequisites","title":"Prerequisites","text":"<ol> <li>Nextflow &gt;= 21.10.3</li> <li>One of:</li> <li>Docker (for local)</li> <li>Singularity (for HPC)</li> </ol> <p>Install Nextflow: <pre><code>curl -s https://get.nextflow.io | bash\nmv nextflow ~/bin/  # or any directory in your PATH\n</code></pre></p>"},{"location":"NEXTFLOW/#quick-start","title":"Quick Start","text":""},{"location":"NEXTFLOW/#1-prepare-samplesheet","title":"1. Prepare Samplesheet","text":"<p>Create a CSV file with your samples:</p> <pre><code>sample,bam,bai\nsample1,/path/to/sample1.bam,/path/to/sample1.bam.bai\nsample2,/path/to/sample2.bam,\nsample3,/path/to/sample3.bam,/path/to/sample3.bam.bai\n</code></pre> <p>Or with per-sample suffix (for multiple BAM types): <pre><code>sample,bam,bai,suffix\nsample1,/path/to/sample1.duplex.bam,,-duplex\nsample1,/path/to/sample1.simplex.bam,,-simplex\nsample1,/path/to/sample1.unfiltered.bam,,-unfiltered\nsample2,/path/to/sample2.bam,,\n</code></pre></p> <p>Notes: - <code>bai</code> column is optional - will auto-discover <code>&lt;bam&gt;.bai</code> if not provided - <code>suffix</code> column is optional - per-row suffix overrides global <code>--suffix</code> parameter - BAI files must exist or workflow will fail early with clear error</p>"},{"location":"NEXTFLOW/#2-run-the-workflow","title":"2. Run the Workflow","text":"<p>Local with Docker: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --outdir results \\\n    -profile docker\n</code></pre></p> <p>SLURM cluster with Singularity: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --outdir results \\\n    -profile slurm\n</code></pre></p>"},{"location":"NEXTFLOW/#parameters","title":"Parameters","text":""},{"location":"NEXTFLOW/#required","title":"Required","text":"Parameter Description <code>--input</code> Path to samplesheet CSV <code>--variants</code> Path to VCF/MAF variants file <code>--fasta</code> Reference FASTA (with .fai index)"},{"location":"NEXTFLOW/#output-options","title":"Output Options","text":"Parameter Default Description <code>--outdir</code> <code>results</code> Output directory <code>--format</code> <code>vcf</code> Output format (<code>vcf</code> or <code>maf</code>) <code>--suffix</code> <code>''</code> Suffix for output filenames"},{"location":"NEXTFLOW/#filtering-options","title":"Filtering Options","text":"Parameter Default Description <code>--min_mapq</code> <code>20</code> Minimum mapping quality <code>--min_baseq</code> <code>0</code> Minimum base quality <code>--filter_duplicates</code> <code>true</code> Filter duplicate reads <code>--filter_secondary</code> <code>false</code> Filter secondary alignments <code>--filter_supplementary</code> <code>false</code> Filter supplementary alignments <code>--filter_qc_failed</code> <code>false</code> Filter QC failed reads <code>--filter_improper_pair</code> <code>false</code> Filter improperly paired reads <code>--filter_indel</code> <code>false</code> Filter reads with indels"},{"location":"NEXTFLOW/#resource-limits","title":"Resource Limits","text":"Parameter Default Description <code>--max_cpus</code> <code>16</code> Maximum CPUs per job <code>--max_memory</code> <code>128.GB</code> Maximum memory per job <code>--max_time</code> <code>240.h</code> Maximum runtime per job"},{"location":"NEXTFLOW/#execution-profiles","title":"Execution Profiles","text":""},{"location":"NEXTFLOW/#docker-local","title":"Docker (Local)","text":"<p><pre><code>-profile docker\n</code></pre> - Uses Docker containers - Best for local development - Requires Docker installed</p>"},{"location":"NEXTFLOW/#singularity-hpc","title":"Singularity (HPC)","text":"<p><pre><code>-profile singularity\n</code></pre> - Uses Singularity images - Best for HPC without SLURM - Requires Singularity installed</p>"},{"location":"NEXTFLOW/#slurm-hpc-cluster","title":"SLURM (HPC Cluster)","text":"<p><pre><code>-profile slurm\n</code></pre> - Submits jobs to SLURM - Uses Singularity containers - Queue: <code>cmobic_cpu</code> (customizable)</p>"},{"location":"NEXTFLOW/#customizing-for-your-cluster","title":"Customizing for Your Cluster","text":"<p>Edit <code>nextflow/nextflow.config</code> to customize the SLURM profile:</p> <pre><code>slurm {\n    process.executor       = 'slurm'\n    process.queue          = 'your_queue_name'  // Change this\n    process.clusterOptions = '--account=your_account'  // Add if needed\n    singularity.enabled    = true\n    singularity.autoMounts = true\n}\n</code></pre> <p>Common customizations: <pre><code>process {\n    withName: GBCMS_RUN {\n        cpus   = 8          // CPUs per sample\n        memory = 16.GB      // Memory per sample\n        time   = 6.h        // Time limit per sample\n    }\n}\n</code></pre></p>"},{"location":"NEXTFLOW/#output-structure","title":"Output Structure","text":"<p>Results are organized in <code>${outdir}/</code>:</p> <pre><code>results/\n\u251c\u2500\u2500 gbcms/\n\u2502   \u251c\u2500\u2500 sample1.vcf        # Or .maf\n\u2502   \u251c\u2500\u2500 sample2.vcf\n\u2502   \u2514\u2500\u2500 sample3.vcf\n\u2514\u2500\u2500 pipeline_info/\n    \u251c\u2500\u2500 execution_report.html\n    \u251c\u2500\u2500 execution_timeline.html\n    \u2514\u2500\u2500 execution_trace.txt\n</code></pre>"},{"location":"NEXTFLOW/#advanced-usage","title":"Advanced Usage","text":""},{"location":"NEXTFLOW/#resume-failed-runs","title":"Resume Failed Runs","text":"<p>Nextflow caches completed tasks. Resume from where it failed:</p> <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    -profile slurm \\\n    -resume\n</code></pre>"},{"location":"NEXTFLOW/#custom-suffix","title":"Custom Suffix","text":"<p>Add suffix to output filenames:</p> <pre><code>--suffix .genotyped\n# Output: sample1.genotyped.vcf\n</code></pre>"},{"location":"NEXTFLOW/#maf-output","title":"MAF Output","text":"<p>Generate MAF instead of VCF:</p> <pre><code>--format maf\n# Output: sample1.maf\n</code></pre>"},{"location":"NEXTFLOW/#strict-filtering","title":"Strict Filtering","text":"<p>Enable all filters for high-quality genotyping:</p> <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    --filter_duplicates true \\\n    --filter_secondary true \\\n    --filter_supplementary true \\\n    --filter_qc_failed true \\\n    -profile slurm\n</code></pre>"},{"location":"NEXTFLOW/#monitoring","title":"Monitoring","text":""},{"location":"NEXTFLOW/#view-running-jobs","title":"View Running Jobs","text":"<pre><code># SLURM\nsqueue -u $USER\n\n# Nextflow\nnextflow log\n</code></pre>"},{"location":"NEXTFLOW/#check-progress","title":"Check Progress","text":"<p>Nextflow prints real-time progress: <pre><code>[c3/a1b2c3] GBCMS_RUN (sample1) [100%] 10 of 10 \u2714\n</code></pre></p>"},{"location":"NEXTFLOW/#execution-report","title":"Execution Report","text":"<p>After completion, view the HTML report: <pre><code>open results/pipeline_info/execution_report.html\n</code></pre></p>"},{"location":"NEXTFLOW/#troubleshooting","title":"Troubleshooting","text":""},{"location":"NEXTFLOW/#job-failed-with-error","title":"Job Failed with Error","text":"<p>Check the work directory in error message: <pre><code>cat work/c3/a1b2c3/.command.log\n</code></pre></p>"},{"location":"NEXTFLOW/#out-of-memory","title":"Out of Memory","text":"<p>Increase memory in config: <pre><code>process {\n    withName: GBCMS_RUN {\n        memory = 32.GB\n    }\n}\n</code></pre></p>"},{"location":"NEXTFLOW/#wrong-queue","title":"Wrong Queue","text":"<p>Update queue name in <code>nextflow/nextflow.config</code>: <pre><code>process.queue = 'your_queue_name'\n</code></pre></p>"},{"location":"NEXTFLOW/#missing-container","title":"Missing Container","text":"<p>Pull the container manually: <pre><code># Singularity\nsingularity pull docker://ghcr.io/msk-access/py-gbcms:2.0.0\n\n# Docker\ndocker pull ghcr.io/msk-access/py-gbcms:2.0.0\n</code></pre></p>"},{"location":"NEXTFLOW/#comparison-with-cli","title":"Comparison with CLI","text":"Feature CLI Nextflow Multiple samples Sequential Parallel Resource management Manual Automatic Retry failed jobs Manual Automatic HPC integration Manual scripts Built-in Resume capability No Yes <p>When to use CLI instead: See Usage Patterns</p>"},{"location":"NEXTFLOW/#next-steps","title":"Next Steps","text":"<ul> <li>See Usage Patterns for comparison with CLI usage</li> <li>See <code>nextflow/README.md</code> for additional workflow documentation</li> </ul>"},{"location":"SUMMARY/","title":"Table of Contents","text":"<ul> <li>Introduction</li> </ul>"},{"location":"SUMMARY/#getting-started","title":"Getting Started","text":"<ul> <li>Installation</li> </ul>"},{"location":"SUMMARY/#usage-patterns","title":"Usage Patterns","text":"<ul> <li>Usage Overview</li> <li>CLI Quick Start</li> <li>Nextflow Workflow</li> </ul>"},{"location":"SUMMARY/#reference","title":"Reference","text":"<ul> <li>Changelog</li> </ul>"},{"location":"SUMMARY/#development","title":"Development","text":"<ul> <li>Contributing</li> </ul>"},{"location":"WORKFLOWS/","title":"Usage Patterns","text":"<p><code>py-gbcms</code> can be used in two ways depending on your needs:</p>"},{"location":"WORKFLOWS/#standalone-cli-singlefew-samples","title":"\ud83d\udd27 Standalone CLI (Single/Few Samples)","text":"<p>Best for: - Processing 1-10 samples - Quick ad-hoc analysis - Local development and testing - Direct control over parameters</p> <p>Pros: - \u2705 Simple - just one command - \u2705 Fast to set up - \u2705 Full control over threading - \u2705 Works anywhere (local, server, container)</p> <p>Cons: - \u274c Manual parallelization for multiple samples - \u274c No automatic resource management - \u274c Requires manual error handling</p> <p>Example: <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample1.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre></p> <p>Learn more: CLI Quick Start</p>"},{"location":"WORKFLOWS/#nextflow-workflow-many-samples-hpc","title":"\ud83d\udd04 Nextflow Workflow (Many Samples, HPC)","text":"<p>Best for: - Processing 10+ samples - HPC/SLURM cluster environments - Reproducible pipelines - Automated retry and error handling</p> <p>Pros: - \u2705 Automatic parallelization across samples - \u2705 Smart resource management - \u2705 Built-in retry logic - \u2705 Resume failed runs - \u2705 Portable (Docker/Singularity)</p> <p>Cons: - \u274c Requires Nextflow installation - \u274c More setup (samplesheet, config) - \u274c Learning curve for Nextflow DSL</p> <p>Example: <pre><code>nextflow run nextflow/main.nf \\\n    --input samplesheet.csv \\\n    --variants variants.vcf \\\n    --fasta reference.fa \\\n    -profile slurm\n</code></pre></p> <p>Learn more: Nextflow Workflow Guide</p>"},{"location":"WORKFLOWS/#quick-comparison","title":"\ud83d\udcca Quick Comparison","text":"Feature CLI Nextflow Setup complexity Low Medium Best for # samples 1-10 10+ Parallelization Manual Automatic Resource management Manual Automatic HPC integration Manual Built-in Resume failed jobs No Yes Reproducibility Good Excellent"},{"location":"WORKFLOWS/#which-should-i-use","title":"Which Should I Use?","text":""},{"location":"WORKFLOWS/#use-cli-if-you","title":"Use CLI if you:","text":"<ul> <li>Have a few samples to process</li> <li>Want quick results</li> <li>Are working locally or on a single server</li> <li>Need full manual control</li> </ul>"},{"location":"WORKFLOWS/#use-nextflow-if-you","title":"Use Nextflow if you:","text":"<ul> <li>Have many samples (10+)</li> <li>Are on an HPC cluster (SLURM, PBS, etc.)</li> <li>Need reproducible pipelines</li> <li>Want automatic parallelization and error handling</li> <li>Plan to re-run the analysis multiple times</li> </ul>"},{"location":"quick-start/","title":"Quick Start Guide","text":"<p>This guide shows you how to get started with <code>py-gbcms</code> using the standalone CLI for processing one or a few samples.</p> <p>Processing many samples? Use the Nextflow Workflow instead for automatic parallelization on HPC clusters.</p>"},{"location":"quick-start/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python &gt;= 3.10</li> <li>Rust toolchain (for installation from source)</li> <li>BAM files with index (.bai)</li> <li>Reference FASTA with index (.fai)</li> <li>Variants file (VCF or MAF)</li> </ul> <p>Install via <code>pip install py-gbcms</code> or see the project README for detailed setup instructions.</p>"},{"location":"quick-start/#basic-usage","title":"Basic Usage","text":""},{"location":"quick-start/#single-sample","title":"Single Sample","text":"<p>Count variants for one sample:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample1.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Output: <code>results/sample1.vcf</code></p>"},{"location":"quick-start/#multiple-samples","title":"Multiple Samples","text":"<p>Process multiple samples sequentially:</p> <pre><code># Sample 1\ngbcms run --variants variants.vcf --bam sample1.bam --fasta ref.fa --output-dir results/\n\n# Sample 2\ngbcms run --variants variants.vcf --bam sample2.bam --fasta ref.fa --output-dir results/\n\n# Sample 3\ngbcms run --variants variants.vcf --bam sample3.bam --fasta ref.fa --output-dir results/\n</code></pre> <p>Or use a BAM list file:</p> <pre><code># Create bam_list.txt with:\n# sample1 /path/to/sample1.bam\n# sample2 /path/to/sample2.bam\n\ngbcms run \\\n    --variants variants.vcf \\\n    --bam-list bam_list.txt \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Note: The CLI processes samples sequentially. For parallel processing of many samples, use the Nextflow Workflow.</p>"},{"location":"quick-start/#common-options","title":"Common Options","text":""},{"location":"quick-start/#output-format","title":"Output Format","text":"<p>VCF (default): <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --format vcf\n</code></pre></p> <p>MAF: <pre><code>gbcms run --variants variants.maf --bam sample.bam --fasta ref.fa --output-dir results/ --format maf\n</code></pre></p>"},{"location":"quick-start/#custom-sample-ids","title":"Custom Sample IDs","text":"<p>Override the sample name:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam MySampleID:sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/\n</code></pre> <p>Output: <code>results/MySampleID.vcf</code></p>"},{"location":"quick-start/#output-suffix","title":"Output Suffix","text":"<p>Add suffix to output filenames:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/ \\\n    --suffix .genotyped\n</code></pre> <p>Output: <code>results/sample.genotyped.vcf</code></p>"},{"location":"quick-start/#threading","title":"Threading","text":"<p>Use multiple threads for processing:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam sample.bam \\\n    --fasta reference.fa \\\n    --output-dir results/ \\\n    --threads 4\n</code></pre>"},{"location":"quick-start/#quality-filters","title":"Quality Filters","text":"<p>Minimum mapping quality: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --min-mapq 30\n</code></pre></p> <p>Minimum base quality: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --min-baseq 20\n</code></pre></p> <p>Filter duplicates (default: enabled): <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --filter-duplicates\n</code></pre></p> <p>Filter secondary alignments: <pre><code>gbcms run --variants variants.vcf --bam sample.bam --fasta ref.fa --output-dir results/ --filter-secondary\n</code></pre></p>"},{"location":"quick-start/#complete-example","title":"Complete Example","text":"<p>Process a sample with strict filtering:</p> <pre><code>gbcms run \\\n    --variants variants.vcf \\\n    --bam TumorSample:tumor.bam \\\n    --fasta hg19.fa \\\n    --output-dir genotyped_results/ \\\n    --format vcf \\\n    --suffix .genotyped \\\n    --threads 8 \\\n    --min-mapq 30 \\\n    --min-baseq 20 \\\n    --filter-duplicates \\\n    --filter-secondary \\\n    --filter-supplementary\n</code></pre> <p>Output: <code>genotyped_results/TumorSample.genotyped.vcf</code></p>"},{"location":"quick-start/#using-docker","title":"Using Docker","text":"<p>Run via Docker container:</p> <pre><code>docker run --rm -v $(pwd):/data ghcr.io/msk-access/py-gbcms:2.0.0 \\\n    gbcms run \\\n    --variants /data/variants.vcf \\\n    --bam /data/sample.bam \\\n    --fasta /data/reference.fa \\\n    --output-dir /data/results/\n</code></pre>"},{"location":"quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Many samples on HPC: See Nextflow Workflow</li> <li>Usage patterns: See Usage Overview</li> </ul>"}]}